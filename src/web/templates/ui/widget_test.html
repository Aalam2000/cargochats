{% extends "base.html" %}
{% block content %}
<h2>Widget test</h2>
<div class="box">
  <div class="muted">token = {{ token }}, client = {{ client }}</div>

  <p>
    Эта страница имитирует поведение виджета (Tilda). Отправляет запрос в
    <code>/public/tilda/chat</code>.
  </p>

  <input id="msg" type="text" placeholder="message" style="width: 60%;" />
  <button onclick="sendMsg()">Send</button>

  <pre id="out" style="margin-top: 12px;"></pre>

  <script>
    async function sendMsg() {
      const text = document.getElementById("msg").value;
      const payload = {
        widget_token: "{{ token }}",
        external_client_id: "{{ client }}",
        text: text
      };

      const r = await fetch("/public/tilda/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await r.json();
      document.getElementById("out").textContent = JSON.stringify(data, null, 2);
    }
  </script>
</div>
{% endblock %}
